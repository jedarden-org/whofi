# Mosquitto MQTT Broker Configuration for CSI Server

# Basic Settings
listener 1883
protocol mqtt

# WebSocket Support
listener 9001
protocol websockets

# Persistence
persistence true
persistence_location /mosquitto/data/

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_type error
log_type warning
log_type notice
log_type information
log_timestamp true

# Connection Settings
connection_messages true
log_timestamp true

# Security
allow_anonymous false
password_file /mosquitto/config/passwd

# Access Control
# CSI data topics
topic readwrite csi/+/data
topic readwrite csi/+/stats
topic readwrite csi/+/config
topic readwrite csi/+/command

# Position and tracking topics
topic readwrite position/+
topic readwrite tracking/+

# Home Assistant integration
topic readwrite homeassistant/+

# System monitoring
topic readwrite system/+
topic readwrite $SYS/broker/+

# QoS and Message Limits
max_queued_messages 1000
message_size_limit 8192

# Client Settings
max_connections 100
max_inflight_messages 20

# Persistence Settings
autosave_interval 1800
autosave_on_changes false
persistent_client_expiration 2h